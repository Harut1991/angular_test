<!-- sample section -->
<section class="under-bg-light section-padding-sm sample-page">
  <div class="container cols-sm-2 justify-center">
    <div class="col-md-s-8 col-sm-7 m-0 br-lg bg-white border box-section">
      <h3 class="mb-4">Submit <span class="color-light">a code</span> sample</h3>
      <h6 class="mb-4">Sample ID (autogenerated)</h6>

      <div>
        <form [formGroup]="sampleForm" (ngSubmit)="submitSample()" novalidate>

          <!-- Sample name -->
          <div class="form-row" toggleErrClass [formControlElement]="sampleForm.get('name')">
            <input type="text" id="sample-name" appFocus [labelId]="'sample-name-label'" formControlName="name" (change)="isSampleNameUnique()"/>
            <label for="sample-name" id="sample-name-label">Sample Name</label>
            <div  *ngFor="let error of validationMessages.sampleName">
              <p class="error-msg" *ngIf="sampleForm.get('name').hasError(error.type)">{{error.message}}</p>
            </div>
          </div>

          <!-- Repo link -->
          <div class="form-row" toggleErrClass [formControlElement]="sampleForm.get('link')">
            <input type="text" id="repo-link" appFocus [labelId]="'repo-link-label'" formControlName="link"/>
            <label for="repo-link" id="repo-link-label">Repo Link</label>
            <div  *ngFor="let error of validationMessages.repoLink">
              <p class="error-msg" *ngIf="sampleForm.get('link').hasError(error.type)">{{error.message}}</p>
            </div>
          </div>

          <!-- Mention Folder -->
          <div class="form-row">
            <input formControlName="mention" type="text" id="specific-file" appFocus [labelId]="'specific-file-label'"/>
            <label for="specific-file" id="specific-file-label">Mention specific folder or file</label>
          </div>

          <div class="sample-dropdowns">
            <!-- Datepicker -->
            <div class="form-row" toggleErrClass [formControlElement]="sampleForm.get('due_date')">
              <mat-form-field>
                <input formControlName="due_date" [(ngModel)]="dueDate" matInput [min]="min" [max]="max" [matDatepicker]="picker" placeholder="Due Date" autocomplete="off">
                <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                <mat-datepicker #picker></mat-datepicker>
              </mat-form-field>

              <div  *ngFor="let error of validationMessages.selectedDueDate">
                <p class="error-msg" *ngIf="sampleForm.get('due_date').hasError(error.type)">{{error.message}}</p>
              </div>
            </div>
            <!-- Priority -->
            <div class="form-row select-row" toggleErrClass [formControlElement]="sampleForm.get('priority')">
              <ng-select appFocus [labelId]="'selected-priority-label'" [ng_select]="priority"
                         formControlName="priority"
                         bindLabel="name"
                         #priority
                         [bindValue]="'id'"
                         [items]="priorityOptions"
                         [searchable]="true"
                         [clearable]="false"
                         [clearOnBackspace]="true"
                         (close)="onCloseHandler()"
              ></ng-select>
              <label id="selected-priority-label">Priority</label>
              <div  *ngFor="let error of validationMessages.priority">
                <p class="error-msg" *ngIf="sampleForm.get('priority').hasError(error.type)">{{error.message}}</p>
              </div>
            </div>
          </div>
          <!-- Upload files button -->
          <!-- TODO - add .has-error to .drag-files if there is an error -->
          <div class="upload-files">
            <div class="drag-files" [ngClass]="{'small': attachedFiles.length > 0, 'has-error': sampleForm.get('file_set').invalid}" fileDnd (filesChanged)="onDragFiles($event)">
              <label>
                <input #input
                       id="browsefiles"
                       type="file"
                       (drop)="input.value = null"
                       (click)="input.value = null"
                       value=""
                       (change)="onFileChange($event)"
                       formControlName="file_set"
                       accept="application/x-7z-compressed,.7z,application/zip,.zip,application/vnd.rar,.rar,.tar.gz,.gz,application/x-tarz, .tar.Z">
                <span class="icon-upload"></span>
                <span>Drag your files or <a class="link">browse</a></span>
              </label>
            </div>
            <p class="error-text active" *ngIf="isSubmitted && sampleForm.get('file_set').hasError('required')">Please select your files</p>
            <p class="error-text active" *ngIf="sampleForm.get('file_set').hasError('fileSize')">File size greater than 10 mb</p>
            <p class="error-text active" *ngIf="sampleForm.get('file_set').hasError('fileType')">Please attach file with allowed format</p>
            <p class="info">*Files should be 10MB max: only .ZIP, .RAR, .7Z, .GZ, .TAR.Z or .TAR.GZ files</p>
          </div>

          <!-- Uploaded file list -->
          <div class="list-files" *ngIf="attachedFiles.length > 0">
            <ul>
              <li *ngFor="let file of attachedFiles; let i = index">
                <span class="icon-file"></span>
                <div class="file-info">
                  <p class="file-name">{{file.filename}}</p>
                  <span class="file-size" *ngIf="file.fileSize">{{file.fileSize}}Mb</span>
                </div>
                <button (click)="deleteFromFilesList(i)"></button>
              </li>
            </ul>
          </div>

          <!-- Short description -->
          <div class="form-row textarea-row mt-2 mb-0" toggleErrClass [formControlElement]="sampleForm.get('description')">
            <label for="code-description" class="shown">Short description of code: no more than 2000 symbols</label>
            <textarea maxlength="2000" id="code-description" rows="7" formControlName="description" required ></textarea>
            <div class="error-msg" *ngFor="let error of validationMessages.description">
              <p *ngIf="sampleForm.get('description').hasError(error.type)" >{{error.message}}</p>
            </div>
          </div>

          <div class="box-section-button">
            <button type="submit" class="btn btn-sm btn-primary">submit</button>
          </div>

        </form>
      </div>
    </div>
  </div>
</section>
<!-- end sample section -->
